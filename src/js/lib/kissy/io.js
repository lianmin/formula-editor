/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Aug 8 13:44
*/
KISSY.add("io","io/form-serializer,io/base,util,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(k,a,n,l){function g(a,c,e,f,j){if(typeof c==="function"){f=e;e=c;c=void 0}return d({type:j||"get",url:a,data:c,success:e,dataType:f})}var k=a("io/form-serializer"),d=a("io/base"),n=a("util");a("io/xhr-transport");a("io/script-transport");a("io/jsonp");a("io/form");a("io/iframe-transport");a("io/methods");n.mix(d,{serialize:k.serialize,getFormData:k.getFormData,
get:g,post:function(a,d,e,f){if(typeof d==="function"){f=e;e=d;d=void 0}return g(a,d,e,f,"post")},jsonp:function(a,d,e){if(typeof d==="function"){e=d;d=void 0}return g(a,d,e,"jsonp")},getScript:a.load,getJSON:function(a,d,e){if(typeof d==="function"){e=d;d=void 0}return g(a,d,e,"json")},upload:function(a,c,e,f,j){if(typeof e==="function"){j=f;f=e;e=void 0}return d({url:a,type:"post",dataType:j,form:c,data:e,success:f})}});l.exports=d});
KISSY.add("io/form-serializer",["util","dom","querystring"],function(k,a,n,l){function g(a){return a.replace(f,"\r\n")}var d=a("util"),h=a("dom"),c=a("querystring"),e=/^(?:select|textarea)/i,f=/\r?\n/g,j,i=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;j={serialize:function(a,d){return c.stringify(j.getFormData(a),void 0,void 0,d||!1)},getFormData:function(a){var f=[],m={};d.each(h.query(a),function(a){if(a.elements){for(var a=a.elements,b=[],r=
0;r<a.length;r++)b.push(a[r]);a=b}else a=[a];f.push.apply(f,a)});f=d.filter(f,function(a){return a.name&&!a.disabled&&(a.checked||e.test(a.nodeName)||i.test(a.type))});d.each(f,function(a){var b=h.val(a),r;null!==b&&(b=d.isArray(b)?d.map(b,g):g(b),r=m[a.name],void 0===r?m[a.name]=b:(d.isArray(r)||(r=m[a.name]=[r]),r.push.apply(r,d.makeArray(b))))});return m}};l.exports=j});
KISSY.add("io/base",["util","querystring","event/custom","promise","url"],function(k,a,n,l){function g(b){var a=b.context;delete b.context;b=h.mix(h.clone(q),b,{deep:!0});b.context=a||b;var d,e=b.type,m=b.dataType,a=b.uri=f.parse(f.resolve(o,b.url),!0);a.query={};"crossDomain"in b||(b.crossDomain=!(a.protocol===p.protocol&&a.host===p.host));e=b.type=e.toUpperCase();b.hasContent=!i.test(e);if(b.processData&&(d=b.data)&&"string"!==typeof d)b.data=c.stringify(d,void 0,void 0,b.serializeArray);m=b.dataType=
h.trim(m||"*").split(j);!("cache"in b)&&h.inArray(m[0],["script","jsonp"])&&(b.cache=!1);b.hasContent||(b.data&&h.mix(a.query,c.parse(b.data)),!1===b.cache&&(a.query._ksTS=h.now()+"_"+h.guid()));return b}function d(b){var a=this;if(!(a instanceof d))return new d(b);d.superclass.constructor.call(a);e.Defer(a);a.userConfig=b;b=g(b);h.mix(a,{responseData:null,config:b||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,
state:0,statusText:null,status:0,transport:null});var f;d.fire("start",{ajaxConfig:b,io:a});f=new (m[b.dataType[0]]||m["*"])(a);a.transport=f;b.contentType&&a.setRequestHeader("Content-Type",b.contentType);var q=b.dataType[0],j,p=b.timeout,c=b.context,o=b.headers,i=b.accepts;a.setRequestHeader("Accept",q&&i[q]?i[q]+("*"===q?"":", */*; q=0.01"):i["*"]);for(j in o)a.setRequestHeader(j,o[j]);if(b.beforeSend&&!1===b.beforeSend.call(c,a,b))return a;a.readyState=1;d.fire("send",{ajaxConfig:b,io:a});b.async&&
0<p&&(a.timeoutTimer=setTimeout(function(){a.abort("timeout")},1E3*p));try{a.state=1,f.send()}catch(l){2>a.state&&a._ioReady(-1,l.message||"send error")}return a}var h=a("util"),c=a("querystring"),k=a("event/custom"),e=a("promise"),f=a("url"),j=/\s+/,a=function(a){return a},i=/^(?:GET|HEAD)$/,o=location.href,p=f.parse(o),n=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(p.protocol),m={},q={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,
processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:h.parseJson,html:a,text:a,xml:h.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};q.converters.html=q.converters.text;h.mix(d,k.Target);h.mix(d,{isLocal:n,setupConfig:function(a){h.mix(q,a,{deep:!0})},setupTransport:function(a,f){m[a]=f},getTransport:function(a){return m[a]},getConfig:function(){return q}});
l.exports=d});
KISSY.add("io/xhr-transport","util,./base,./xhr-transport-base,./xdr-flash-transport,./sub-domain-transport,logger-manager".split(","),function(k,a){function n(a){var i=a.config,o=i.crossDomain,p=i.xdr||{},m=p.subDomain=p.subDomain||{};this.io=a;if(o&&!d.supportCORS){if(e.domain&&l.endsWith(i.uri.hostname,e.domain)&&m.proxy!==false)return new c(a);if(""+p.use==="flash"||!f)return new h(a)}this.nativeXhr=d.nativeXhr(o);return this}var l=a("util"),g=a("./base"),d=a("./xhr-transport-base"),h=a("./xdr-flash-transport"),
c=a("./sub-domain-transport");a("logger-manager");var e=document,f=d.XDomainRequest_;l.augment(n,d.proto,{send:function(){this.sendInternal()}});g.setupTransport("*",n)});
KISSY.add("io/xhr-transport-base","util,url,querystring,./base,ua,logger-manager".split(","),function(k,a,n,l){function g(a,b){try{return new (b||i).XMLHttpRequest}catch(f){}}function d(a){var b;if(a.ifModified){b=a.uri;if(a.cache===false){b=h.clone(b);delete b.query._ksTS}b=c.stringify(b)}return b}var h=a("util"),c=a("url"),e=a("querystring"),f=a("./base"),k=a("ua");a("logger-manager");var j,i=window,o=k.ieMode>7&&i.XDomainRequest,a={proto:{}},p={},m={};f.__lastModifiedCached=p;f.__eTagCached=m;
a.nativeXhr=i.ActiveXObject?function(a,b){var d;if(!j&&a&&o)d=new o;else if(!(d=!f.isLocal&&g(a,b)))a:{try{d=new (b||i).ActiveXObject("Microsoft.XMLHTTP");break a}catch(e){}d=void 0}return d}:g;j=a.supportCORS="withCredentials"in a.nativeXhr();a.XDomainRequest_=o;h.mix(a.proto,{sendInternal:function(){var a=this,b=a.io,f=b.config,c=a.nativeXhr,i=f.files,g=i?"post":f.type,l=f.async,n,k=b.mimeType,t=b.requestHeaders||{},b=b._getUrlForSend(),v=d(f),s,w;if(v){if(s=p[v])t["If-Modified-Since"]=s;if(s=m[v])t["If-None-Match"]=
s}(n=f.username)?c.open(g,b,l,n,f.password):c.open(g,b,l);g=f.xhrFields||{};"withCredentials"in g&&(j||delete g.withCredentials);for(w in g)try{c[w]=g[w]}catch(z){}k&&c.overrideMimeType&&c.overrideMimeType(k);t["X-Requested-With"]===false&&delete t["X-Requested-With"];if(typeof c.setRequestHeader!=="undefined")for(w in t)c.setRequestHeader(w,t[w]);var x=f.hasContent&&f.data||null;if(i){k=x;t={};k&&(t=e.parse(k));t=h.mix(t,i);x=new FormData;h.each(t,function(a,b){h.isArray(a)?h.each(a,function(a){x.append(b+
(f.serializeArray?"[]":""),a)}):x.append(b,a)})}c.send(x);if(!l||c.readyState===4)a._callback();else if(o&&c instanceof o){c.onload=function(){c.readyState=4;c.status=200;a._callback()};c.onerror=function(){c.readyState=4;c.status=500;a._callback()}}else c.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,b){var e=this.nativeXhr,c=this.io,j,i,g,l,n,k=c.config;try{if(b||e.readyState===4){if(o&&e instanceof o){e.onerror=h.noop;e.onload=h.noop}else e.onreadystatechange=
h.noop;if(b)e.readyState!==4&&e.abort();else{j=d(k);var v=e.status;if(!(o&&e instanceof o))c.responseHeadersString=e.getAllResponseHeaders();if(j){i=e.getResponseHeader("Last-Modified");g=e.getResponseHeader("ETag");i&&(p[j]=i);g&&(m[g]=g)}if((n=e.responseXML)&&n.documentElement)c.responseXML=n;var s=c.responseText=e.responseText;if(k.files&&s){var w,z;if((w=s.indexOf("<body>"))!==-1){z=s.lastIndexOf("</body>");if(z===-1)z=s.length;s=s.slice(w+6,z)}c.responseText=h.unEscapeHtml(s)}try{l=e.statusText}catch(x){l=
""}!v&&f.isLocal&&!k.crossDomain?v=c.responseText?200:404:v===1223&&(v=204);c._ioReady(v,l)}}}catch(A){e.onreadystatechange=h.noop;b||c._ioReady(-1,A.message||"process error")}}});l.exports=a});
KISSY.add("io/xdr-flash-transport",["util","./base","dom","logger-manager"],function(k,a,n,l){function g(a,f,b){p||(p=!0,a='<object id="'+j+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+f+"&uid="+b+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',f=o.createElement("div"),e.prepend(f,o.body||o.documentElement),f.innerHTML=a)}function d(a){this.io=a}var h=a("util"),c=a("./base"),
e=a("dom");a("logger-manager");var f={},j="io_swf",i,o=document,p=!1;h.augment(d,{send:function(){var e=this,d=e.io,b=d.config,c=b.xdr||{};c.src||(c.src=a.resolve("./assets/io.swf"));g(c.src,1,1);i?(e._uid=h.guid(),f[e._uid]=e,i.send(d._getUrlForSend(),{id:e._uid,uid:e._uid,method:b.type,data:b.hasContent&&b.data||{}})):setTimeout(function(){e.send()},200)},abort:function(){i.abort(this._uid)},_xdrResponse:function(a,e){var b,d=e.id,c,j=e.c,p=this.io;if(j&&(c=j.responseText))p.responseText=decodeURI(c);
switch(a){case "success":b={status:200,statusText:"success"};delete f[d];break;case "abort":delete f[d];break;case "timeout":case "transport error":case "failure":delete f[d],b={status:"status"in j?j.status:500,statusText:j.statusText||a}}b&&p._ioReady(b.status,b.statusText)}});c.applyTo=function(a,e,b){var a=e.split(".").slice(1),f=c;h.each(a,function(a){f=f[a]});f.apply(null,b)};c.xdrReady=function(){i=o.getElementById(j)};c.xdrResponse=function(a,e){var b=f[e.uid];b&&b._xdrResponse(a,e)};KISSY.IO=
c;l.exports=d});
KISSY.add("io/sub-domain-transport","util,event/dom,url,dom,./xhr-transport-base,logger-manager".split(","),function(k,a,n,l){function g(a){var e=a.config;this.io=a;e.crossDomain=false}function d(){var a=i[this.io.config.uri.hostname];a.ready=1;h.detach(a.iframe,"load",d,this);this.send()}var k=a("util"),h=a("event/dom"),c=a("url"),e=a("dom"),f=a("./xhr-transport-base");a("logger-manager");var j=document,i={};k.augment(g,f.proto,{send:function(){var a=this.io.config,p=a.uri,m=p.hostname,g=i[m],b=
"/sub_domain_proxy.html";if(a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy)b=a.xdr.subDomain.proxy;if(g&&g.ready)(this.nativeXhr=f.nativeXhr(0,g.iframe.contentWindow))&&this.sendInternal();else{if(g)a=g.iframe;else{g=i[m]={};a=g.iframe=j.createElement("iframe");e.css(a,{position:"absolute",left:"-9999px",top:"-9999px"});e.prepend(a,j.body||j.documentElement);m={};m.protocol=p.protocol;m.host=p.host;m.pathname=b;a.src=c.stringify(m)}h.on(a,"load",d,this)}}});l.exports=g});
KISSY.add("io/script-transport",["util","./base","logger-manager"],function(k,a){function n(a){if(!a.config.crossDomain)return new (g.getTransport("*"))(a);this.io=a;return this}var l=a("util"),g=a("./base");a("logger-manager");g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){l.globalEval(a);return a}}}});l.augment(n,{send:function(){var d=this,
g=d.io,c=g.config;d.script=a.load(g._getUrlForSend(),{charset:c.scriptCharset,success:function(){d._callback("success")},error:function(){d._callback("error")}})},_callback:function(a,g){var c=this.io;this.script&&(this.script=void 0,g||("error"!==a?c._ioReady(200,"success"):"error"===a&&c._ioReady(500,"script error")))},abort:function(){this._callback(0,1)}});g.setupTransport("script",n)});
KISSY.add("io/jsonp",["util","./base"],function(k,a){var n=a("util"),l=a("./base"),g=window;l.setupConfig({jsonp:"callback",jsonpCallback:function(){return n.guid("jsonp")}});l.on("start",function(a){var h=a.io,c=h.config,a=c.dataType;if("jsonp"===a[0]){delete c.contentType;var e,f=c.jsonpCallback,j="function"===typeof f?f():f,i=g[j];c.uri.query[c.jsonp]=j;g[j]=function(a){1<arguments.length&&(a=n.makeArray(arguments));e=[a]};h.fin(function(){g[j]=i;if(void 0===i)try{delete g[j]}catch(a){}else e&&
i(e[0])});h=c.converters;h.script=h.script||{};h.script.json=function(){if(!e)throw Error("not call jsonpCallback: "+j);return e[0]};a.length=2;a[0]="script";a[1]="json"}})});
KISSY.add("io/form",["util","./base","dom","querystring","./form-serializer"],function(k,a){var n=a("util"),l=a("./base"),g=a("dom"),d=a("querystring"),h=a("./form-serializer"),c=Array.prototype.slice,e=window.FormData;l.on("start",function(a){var j,i,a=a.io.config;if(i=a.form){j=g.get(i);i=a.data;for(var l=!1,p={},m=g.query("input",j),q=0,b=m.length;q<b;q++){var r=m[q];if("file"===r.type.toLowerCase()){l=!0;if(!e)break;var k=c.call(r.files,0);p[g.attr(r,"name")]=1<k.length?k:k[0]||null}}l&&e&&(a.files=
a.files||{},n.mix(a.files,p),delete a.contentType);!l||e?(j=h.getFormData(j),a.hasContent?(j=d.stringify(j,void 0,void 0,a.serializeArray),a.data=i?a.data+("&"+j):j):n.mix(a.uri.query,j)):(i=a.dataType,a=i[0],"*"===a&&(a="text"),i.length=2,i[0]="iframe",i[1]=a)}})});
KISSY.add("io/iframe-transport","util,querystring,dom,./base,event/dom,logger-manager,ua".split(","),function(k,a){function n(a){var e=d.guid("io-iframe"),f=c.getEmptyIframeSrc(),a=a.iframe=c.create("<iframe "+(f?' src="'+f+'" ':"")+' id="'+e+'" name="'+e+'" style="position:absolute;left:-9999px;top:-9999px;"/>');c.prepend(a,i.body||i.documentElement);return a}function l(a,e,f){var b=[],j,g,h;d.each(a,function(a,p){(j=d.isArray(a))||(a=[a]);for(g=0;g<a.length;g++){h=i.createElement("input");h.type=
"hidden";h.name=p+(j&&f?"[]":"");h.value=a[g];c.append(h,e);b.push(h)}});return b}function g(a){this.io=a}var d=a("util"),h=a("querystring"),c=a("dom"),e=a("./base"),f=a("event/dom");a("logger-manager");var j=a("ua"),i=document,o=d.clone(e.getConfig().converters.text);o.json=function(a){return d.parseJson(d.unEscapeHtml(a))};e.setupConfig({converters:{iframe:o,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});d.augment(g,{send:function(){function a(){f.on(i,"load error",e._callback,
e);u.submit()}var e=this,d=e.io,b=d.config,g,i,k,o=b.data,u=c.get(b.form);e.attrs={target:c.attr(u,"target")||"",action:c.attr(u,"action")||"",encoding:c.attr(u,"encoding"),enctype:c.attr(u,"enctype"),method:c.attr(u,"method")};e.form=u;i=n(d);c.attr(u,{target:i.id,action:d._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});o&&(k=h.parse(o));k&&(g=l(k,u,b.serializeArray));e.fields=g;j.ie===6?setTimeout(a,0):a()},_callback:function(a){var e=this,g=e.form,
b=e.io,a=a.type,i,h=b.iframe;if(h){a==="abort"&&j.ie===6?setTimeout(function(){c.attr(g,e.attrs)},0):c.attr(g,e.attrs);c.remove(this.fields);f.detach(h);setTimeout(function(){c.remove(h)},30);b.iframe=null;if(a==="load")try{if((i=h.contentWindow.document)&&i.body){b.responseText=c.html(i.body);if(d.startsWith(b.responseText,"<?xml"))b.responseText=void 0}b.responseXML=i&&i.XMLDocument?i.XMLDocument:i;i?b._ioReady(200,"success"):b._ioReady(500,"parser error")}catch(l){b._ioReady(500,"parser error")}else a===
"error"&&b._ioReady(500,"error")}},abort:function(){this._callback({type:"abort"})}});e.setupTransport("iframe",g)});
KISSY.add("io/methods",["util","promise","./base","url"],function(k,a){function n(a){var f=a.responseText,d=a.responseXML,c=a.config,g=c.converters,h,m,k=c.contents,b=c.dataType;if(f||d){for(c=a.mimeType||a.getResponseHeader("Content-Type");"*"===b[0];)b.shift();if(!b.length)for(h in k)if(k[h].test(c)){b[0]!==h&&b.unshift(h);break}b[0]=b[0]||"text";for(h=0;h<b.length;h++)if("text"===b[h]&&void 0!==f){m=f;break}else if("xml"===b[h]&&void 0!==d){m=d;break}if(!m){var n={text:f,xml:d};l.each(["text",
"xml"],function(a){var e=b[0];if(g[a]&&g[a][e]&&n[a])return b.unshift(a),m="text"===a?f:d,!1})}}k=b[0];for(c=1;c<b.length;c++){h=b[c];var y=g[k]&&g[k][h];if(!y)throw Error("no covert for "+k+" => "+h);m=y(m);k=h}a.responseData=m}var l=a("util"),g=a("promise"),d=a("./base"),h=a("url"),c=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm;l.extend(d,g,{setRequestHeader:function(a,c){this.requestHeaders[a]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(a){var f,
d,a=a.toLowerCase();if(2===this.state){if(!(d=this.responseHeaders))for(d=this.responseHeaders={};f=c.exec(this.responseHeadersString);)d[f[1].toLowerCase()]=f[2];f=d[a]}return void 0===f?null:f},overrideMimeType:function(a){this.state||(this.mimeType=a);return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this._ioReady(0,a);return this},getNativeXhr:function(){var a=this.transport;return a?a.nativeXhr:null},_ioReady:function(a,c){if(2!==this.state){this.state=2;this.readyState=
4;var g;if(200<=a&&300>a||304===a)if(304===a)c="not modified",g=!0;else try{n(this),c="success",g=!0}catch(h){c=h.message||"parser error"}else 0>a&&(a=0);this.status=a;this.statusText=c;var k=this.defer,l=this.config,m;if(m=this.timeoutTimer)clearTimeout(m),this.timeoutTimer=0;m=g?"success":"error";var q,b=[this.responseData,c,this],r=l.context,y={ajaxConfig:l,io:this};(q=l[m])&&q.apply(r,b);(q=l.complete)&&q.apply(r,b);d.fire(m,y);d.fire("complete",y);k[g?"resolve":"reject"](b)}},_getUrlForSend:function(){var a=
this.config,c=a.uri,d=c.search||"";delete c.search;d&&!l.isEmptyObject(c.query)&&(d="&"+d.substring(1));return h.stringify(c,a.serializeArray)+d}})});
