/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Aug 6 11:08
*/
KISSY.add("reactive",[],function(w,x,y,s){function j(){}function m(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}function n(a,b){for(var c in b)a[c]=b[c];return a}function t(a,b){return function(){a.apply(b,arguments)}}function g(a){this._listeners=[];this._endListeners=[];this._subscribeFn=a;this._children=[];this._pushEvent=t(u,this);this._event=this._unSubscribeFn=null}function o(a,b){a.handler&&(b=a.handler(b));if(a._event=b)for(var c=a._listeners.concat(),d=0,e=c.length;d<
e;d++)b.currentTarget=a,c[d].fn.call(c[d].context,b)}function u(a){a===k.END?(p(this),q(this)):(a={value:a,currentTarget:this,target:this},o(this,a))}function l(a){o(this,a)}function p(a){if(!a._listeners.length){for(var b=a._children,c=0,d=b.length;c<d;c++)b[c].detach(l,a);a._unSubscribeFn();a._unSubscribeFn=null}}function q(a){for(var a=a._endListeners.concat(),b=0,c=a.length;b<c;b++)a[b]()}function h(a,b){function c(){var e=m(d,b);-1!==e&&d.splice(e,1);0===d.length&&q(a);var e=b,f=m(e._endListeners,
c);-1!==f&&e._endListeners.splice(f,1)}var d=a._children;d.push(b);b._endListeners.push(c);if(a._unSubscribeFn)b.on(l,a)}function r(a,b,c){for(var a=a._listeners,d=0,e=a.length;d<e;d++)if(a[d].fn===b&&a[d].context===c)return d;return-1}function v(a){var b=this._events,c=a.target,d=this._children,e=d.length,f;for(f=0;f<e;f++)if(d[f]===c){b[f]=a;break}if(e===b.length){a=[];for(f=0;f<e;f++)if(b[f])a[f]=b[f].value;else return;return{target:this,currentTarget:this,value:a}}}function i(){g.apply(this,arguments)}
var k=s.exports={END:{}};n(g.prototype,{isEventStream:1,filter:function(a){var b=new this.constructor;b.handler=function(b){if(a(b.value))return{target:b.target,value:b.value}};h(b,this);return b},map:function(a){var b=this,c=new b.constructor;c.handler=function(d){if(b===d.currentTarget){var e=a(d.value);if(e&&e.isEventStream)h(c,e);else return{target:d.target,value:e}}else return d};h(c,b);return c},startsWith:function(a){this._event||(this._event={value:a,currentTarget:this,target:this});return this},
onValue:function(a,b){var c=this,b=b||this,d=function(c){a.call(b,c.value)};this.on(d,b);return function(){c.detach(d,b)}},on:function(a,b){if(!this._listeners.length){this._unSubscribeFn=this._subscribeFn?this._subscribeFn(this._pushEvent):j;for(var c=this._children,d=0,e=c.length;d<e;d++)c[d].on(l,this)}b=b||this;-1===r(this,a,b)&&this._listeners.push({fn:a,context:b});return this},detach:function(a,b){var c=this._listeners,d=r(this,a,b||this);-1!==d&&c.splice(d,1);p(this);return this},combine:function(){var a=
arguments,b=new i;b._events=[];b.handler=v;h(b,this);for(var c=0,d=a.length;c<d;c++)h(b,a[c]);return b}});j.prototype=g.prototype;i.prototype=new j;n(i.prototype,{constructor:i,on:function(a,b){g.prototype.on.apply(this,arguments);this._event&&a.call(b,this._event)}});k.createEventStream=function(a){return new g(a)};k.createProperty=function(a){return new i(a)}});
